{"version":3,"sources":["../src/routes/copyFileRoute.ts"],"names":["fs","__importStar","require","errors_1","exports","copyFileRoute","method","url","schema","body","source","type","dest","response","200","properties","result","404","code","message","preHandler","request","reply","__awaiter","__generator","this","_a","handler","_b","status","send","InvalidParamsError","toLowerCase","accessSync","src","createReadStream","dt","createWriteStream","pipe","on","err","name","e"],"mappings":"skEAEA,IAAAA,GAAAC,aAAAC,QAAA,OAEAC,SAAAD,QAAA,aAUaE,QAAAC,cAA8B,CACzCC,OAAQ,OACRC,IAAK,aACLC,OAAQ,CACNC,KAAM,CACJC,OAAQ,CAAEC,KAAM,UAChBC,KAAM,CAAED,KAAM,WAEhBE,SAAU,CACRC,IAAK,CACHH,KAAM,SACNI,WAAY,CACVC,OAAQ,CAAEL,KAAM,aAGpBM,IAAK,CACHN,KAAM,SACNI,WAAY,CACVG,KAAM,CAAEP,KAAM,UACdQ,QAAS,CAAER,KAAM,cAKzBS,WAAY,SAAOC,EAAcC,GAAK,OAAAC,eAAA,OAAA,OAAA,EAAA,WAAA,OAAAC,YAAAC,KAAA,SAAAC,G,eACtCC,QAAS,SAAOD,EAAiCJ,G,IAA/BM,EAAAF,EAAAjB,KAAQC,EAAMkB,EAAAlB,OAAEE,EAAIgB,EAAAhB,K,6FACpC,GAAsB,iBAAXF,GAAuC,iBAATE,EACvC,MAAA,CAAA,EAAOU,EAAMO,OAAO,KAAKC,KAAK3B,SAAA4B,mBAAmB,CAAErB,OAAMA,EAAEE,KAAIA,MAGjE,GAAIF,EAAOsB,gBAAkBpB,EAAKoB,cAChC,MAAA,CAAA,EAAOV,EAAMO,OAAO,KAAKC,KAAK3B,SAAA4B,mBAAmB,CAAErB,OAAMA,EAAEE,KAAIA,MAGjE,IACEZ,GAAGiC,WAAWvB,GAERwB,EAAMlC,GAAGmC,iBAAiBzB,GAC1B0B,EAAKpC,GAAGqC,kBAAkBzB,GAEhCsB,EAAII,KAAKF,GAETF,EAAIK,GAAG,QAAS,SAACC,GACflB,EAAMO,OAAO,KAAKC,KAAK,CACrBZ,KAAMsB,EAAIC,KACVtB,QAASqB,EAAIrB,YAIjBe,EAAIK,GAAG,MAAO,WACZjB,EAAMO,OAAO,KAAKC,KAAK,CAAEd,QAAQ,MAEnC,MAAO0B,GACP,MAAA,CAAA,EAAOpB,EAAMO,OAAO,KAAKC,KAAKY,I","file":"copyFileRoute.js","sourcesContent":["import { RouteOptions, FastifyRequest } from \"fastify\";\nimport { RouteGenericInterface } from \"fastify/types/route\";\nimport * as fs from \"fs\";\nimport { IncomingMessage, Server } from \"http\";\nimport { InvalidParamsError } from \"../errors\";\n\ninterface Req\n  extends FastifyRequest<RouteGenericInterface, Server, IncomingMessage> {\n  body: {\n    source: string;\n    dest: string;\n  };\n}\n\nexport const copyFileRoute: RouteOptions = {\n  method: \"POST\",\n  url: \"/file/copy\",\n  schema: {\n    body: {\n      source: { type: \"string\" },\n      dest: { type: \"string\" },\n    },\n    response: {\n      200: {\n        type: \"object\",\n        properties: {\n          result: { type: \"boolean\" },\n        },\n      },\n      404: {\n        type: \"object\",\n        properties: {\n          code: { type: \"string\" },\n          message: { type: \"string\" },\n        },\n      },\n    },\n  },\n  preHandler: async (request: Req, reply) => {},\n  handler: async ({ body: { source, dest } }: Req, reply) => {\n    if (typeof source !== \"string\" || typeof dest !== \"string\") {\n      return reply.status(404).send(InvalidParamsError({ source, dest }));\n    }\n\n    if (source.toLowerCase() === dest.toLowerCase()) {\n      return reply.status(404).send(InvalidParamsError({ source, dest }));\n    }\n\n    try {\n      fs.accessSync(source);\n\n      const src = fs.createReadStream(source);\n      const dt = fs.createWriteStream(dest);\n\n      src.pipe(dt);\n\n      src.on(\"error\", (err) => {\n        reply.status(404).send({\n          code: err.name,\n          message: err.message,\n        });\n      });\n\n      src.on(\"end\", () => {\n        reply.status(200).send({ result: true });\n      });\n    } catch (e) {\n      return reply.status(404).send(e);\n    }\n  },\n};\n"]}